"use strict";(self.webpackChunktemp=self.webpackChunktemp||[]).push([[190],{3905:(e,t,n)=>{n.d(t,{Zo:()=>m,kt:()=>k});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var p=a.createContext({}),s=function(e){var t=a.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},m=function(e){var t=s(e.components);return a.createElement(p.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},c=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,p=e.parentName,m=i(e,["components","mdxType","originalType","parentName"]),c=s(n),k=r,u=c["".concat(p,".").concat(k)]||c[k]||d[k]||o;return n?a.createElement(u,l(l({ref:t},m),{},{components:n})):a.createElement(u,l({ref:t},m))}));function k(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,l=new Array(o);l[0]=c;var i={};for(var p in t)hasOwnProperty.call(t,p)&&(i[p]=t[p]);i.originalType=e,i.mdxType="string"==typeof e?e:r,l[1]=i;for(var s=2;s<o;s++)l[s]=n[s];return a.createElement.apply(null,l)}return a.createElement.apply(null,n)}c.displayName="MDXCreateElement"},8857:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>p,contentTitle:()=>l,default:()=>d,frontMatter:()=>o,metadata:()=>i,toc:()=>s});var a=n(7462),r=(n(7294),n(3905));const o={sidebar_position:6,description:"\ud83d\udccc DB container \uc640 data generator container \ub97c \ud568\uaed8 \ub744\uc6b0\uae30 \uc704\ud55c `docker-compose` \ud30c\uc77c\uc744 \uc791\uc131\ud569\ub2c8\ub2e4."},l="6) Data Generator on Docker Compose",i={unversionedId:"database/data-generator-docker-compose",id:"database/data-generator-docker-compose",title:"6) Data Generator on Docker Compose",description:"\ud83d\udccc DB container \uc640 data generator container \ub97c \ud568\uaed8 \ub744\uc6b0\uae30 \uc704\ud55c `docker-compose` \ud30c\uc77c\uc744 \uc791\uc131\ud569\ub2c8\ub2e4.",source:"@site/docs/database/data-generator-docker-compose.md",sourceDirName:"database",slug:"/database/data-generator-docker-compose",permalink:"/tutorial/docs/database/data-generator-docker-compose",draft:!1,editUrl:"https://github.com/mlops-for-mle/tutorial/tree/main/docs/database/data-generator-docker-compose.md",tags:[],version:"current",lastUpdatedBy:"Aiden-Jeon",lastUpdatedAt:1670484930,formattedLastUpdatedAt:"Dec 8, 2022",sidebarPosition:6,frontMatter:{sidebar_position:6,description:"\ud83d\udccc DB container \uc640 data generator container \ub97c \ud568\uaed8 \ub744\uc6b0\uae30 \uc704\ud55c `docker-compose` \ud30c\uc77c\uc744 \uc791\uc131\ud569\ub2c8\ub2e4."},sidebar:"tutorialSidebar",previous:{title:"5) Data Generator on Docker",permalink:"/tutorial/docs/database/data-generator-docker"},next:{title:"02. Model Development",permalink:"/tutorial/docs/category/02-model-development"}},p={},s=[{value:"\ubaa9\ud45c",id:"\ubaa9\ud45c",level:2},{value:"\uc2a4\ud399 \uba85\uc138\uc11c",id:"\uc2a4\ud399-\uba85\uc138\uc11c",level:2},{value:"0. \ud658\uacbd \uc124\uc815",id:"0-\ud658\uacbd-\uc124\uc815",level:2},{value:"1. Dockerfile \uc791\uc131",id:"1-dockerfile-\uc791\uc131",level:2},{value:"1.1 Dockerfile",id:"11-dockerfile",level:3},{value:"2. Docker-compose",id:"2-docker-compose",level:2},{value:"2.1 DB service \uc791\uc131",id:"21-db-service-\uc791\uc131",level:3},{value:"2.2 Data generator service \uc791\uc131",id:"22-data-generator-service-\uc791\uc131",level:3},{value:"2.3 Docker-compose healthcheck \uc124\uc815",id:"23-docker-compose-healthcheck-\uc124\uc815",level:3},{value:"3. \ub370\uc774\ud130 \ud655\uc778",id:"3-\ub370\uc774\ud130-\ud655\uc778",level:2},{value:"3.1 Local \uc5d0\uc11c \ud655\uc778",id:"31-local-\uc5d0\uc11c-\ud655\uc778",level:3},{value:"3.2 Data generator container \uc5d0\uc11c \ud655\uc778",id:"32-data-generator-container-\uc5d0\uc11c-\ud655\uc778",level:3},{value:"3.3 docker-compose \uc885\ub8cc",id:"33-docker-compose-\uc885\ub8cc",level:3}],m={toc:s};function d(e){let{components:t,...o}=e;return(0,r.kt)("wrapper",(0,a.Z)({},m,o,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"6-data-generator-on-docker-compose"},"6) Data Generator on Docker Compose"),(0,r.kt)("h2",{id:"\ubaa9\ud45c"},"\ubaa9\ud45c"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Docker \uc704\uc5d0\uc11c \ub370\uc774\ud130\ub97c \uc0dd\uc131\ud558\uae30 \uc704\ud55c \uc900\ube44\ub85c\uc368 ",(0,r.kt)("inlineCode",{parentName:"li"},"Dockerfile")," \uc744 \uc791\uc131\ud569\ub2c8\ub2e4."),(0,r.kt)("li",{parentName:"ol"},"DB container \uc640 data generator container \ub97c \ud568\uaed8 \ub744\uc6b0\uae30 \uc704\ud55c ",(0,r.kt)("inlineCode",{parentName:"li"},"docker-compose")," \ud30c\uc77c\uc744 \uc791\uc131\ud569\ub2c8\ub2e4."),(0,r.kt)("li",{parentName:"ol"},"DB \uc548\uc5d0 \ub370\uc774\ud130\uac00 \uacc4\uc18d\ud574\uc11c \uc0bd\uc785\ub418\uace0 \uc788\ub294\uc9c0 \ud655\uc778\ud569\ub2c8\ub2e4.")),(0,r.kt)("h2",{id:"\uc2a4\ud399-\uba85\uc138\uc11c"},"\uc2a4\ud399 \uba85\uc138\uc11c"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"\uc774\uc804 \uc7a5\uc5d0\uc11c \uc791\uc131\ud55c script \ub97c build \ud560 \uc218 \uc788\ub294 ",(0,r.kt)("inlineCode",{parentName:"li"},"Dockerfile")," \uc744 \uc791\uc131\ud569\ub2c8\ub2e4.",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Base image\ub294 ",(0,r.kt)("inlineCode",{parentName:"li"},"amd64/python:3.9-slim")," \uc744 \uc0ac\uc6a9\ud569\ub2c8\ub2e4."),(0,r.kt)("li",{parentName:"ul"},"Container \uc5d0\uc11c psql \uc744 \uc774\uc6a9\ud558\uc5ec DB\uc5d0 \uc811\uadfc\ud560 \uc218 \uc788\ub3c4\ub85d ",(0,r.kt)("inlineCode",{parentName:"li"},"postgresql-client")," \ub97c \uc124\uce58\ud569\ub2c8\ub2e4."))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("inlineCode",{parentName:"li"},"docker-compose.yaml")," \ud30c\uc77c\uc744 \uc791\uc131\ud569\ub2c8\ub2e4.",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Postgres server",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Service name : ",(0,r.kt)("inlineCode",{parentName:"li"},"db")),(0,r.kt)("li",{parentName:"ul"},"Image : ",(0,r.kt)("inlineCode",{parentName:"li"},"postgres:14.0")),(0,r.kt)("li",{parentName:"ul"},"Container name : ",(0,r.kt)("inlineCode",{parentName:"li"},"postgres-server")),(0,r.kt)("li",{parentName:"ul"},"Environment",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"POSTGRES_USER")," : ",(0,r.kt)("inlineCode",{parentName:"li"},"myuser")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"POSTGRES_PASSWORD")," : ",(0,r.kt)("inlineCode",{parentName:"li"},"mypassword")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"POSTGRES_DB")," : ",(0,r.kt)("inlineCode",{parentName:"li"},"mydatabase")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"TZ")," : ",(0,r.kt)("inlineCode",{parentName:"li"},"Asia/Seoul")))),(0,r.kt)("li",{parentName:"ul"},"Port : ",(0,r.kt)("inlineCode",{parentName:"li"},"5432:5432")))),(0,r.kt)("li",{parentName:"ul"},"Data generator server",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Service name : ",(0,r.kt)("inlineCode",{parentName:"li"},"data-generator")),(0,r.kt)("li",{parentName:"ul"},"Image : ",(0,r.kt)("inlineCode",{parentName:"li"},"Dockerfile")),(0,r.kt)("li",{parentName:"ul"},"Container name : ",(0,r.kt)("inlineCode",{parentName:"li"},"data-generator-server")),(0,r.kt)("li",{parentName:"ul"},"Environment",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"TZ : ",(0,r.kt)("inlineCode",{parentName:"li"},"Asia/Seoul")))),(0,r.kt)("li",{parentName:"ul"},"Command",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"create_table.py")," \uc2e4\ud589"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"generate_data.py")," \uc2e4\ud589"))))),(0,r.kt)("li",{parentName:"ul"},"(",(0,r.kt)("strong",{parentName:"li"},"\uc911\uc694"),") Postgres server \uc640 data generator server\ub97c \ub744\uc6b8 \ub54c \uc5b4\ub5a4 service \uac00 \uba3c\uc800 \ub744\uc6cc\uc838\uc57c\ud558\ub294\uc9c0 \uc0dd\uac01\ud574\ubcf4\uace0, \uadf8 \uae30\ub2a5\uc744 yaml \ud30c\uc77c\uc5d0 \ucd94\uac00\ud569\ub2c8\ub2e4."))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("inlineCode",{parentName:"li"},"docker-compose.yaml")," \uc744 \uc2e4\ud589\ud569\ub2c8\ub2e4."),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("inlineCode",{parentName:"li"},"psql"),"\xa0\uc744 \uc774\uc6a9\ud558\uc5ec DB\uc5d0 \ub370\uc774\ud130\uac00 \uacc4\uc18d\ud574\uc11c \uc313\uc774\uace0 \uc788\ub294\uc9c0 \ud655\uc778\ud569\ub2c8\ub2e4.",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Local \uc5d0\uc11c \ud655\uc778\ud569\ub2c8\ub2e4."),(0,r.kt)("li",{parentName:"ul"},"Data generator server \uc5d0\uc11c \ud655\uc778\ud569\ub2c8\ub2e4.")))),(0,r.kt)("hr",null),(0,r.kt)("h2",{id:"0-\ud658\uacbd-\uc124\uc815"},"0. \ud658\uacbd \uc124\uc815"),(0,r.kt)("p",null,"\uc774\ubc88 \uc7a5\uc5d0\uc11c\ub294 Docker Compose \ub97c \uc774\uc6a9\ud574 \ucee8\ud14c\uc774\ub108\ub97c \ub744\uc6b0\ub294 \ubc95\uc5d0 \ub300\ud574\uc11c \uc2e4\uc2b5\ud569\ub2c8\ub2e4. \uc774\ub97c \uc704\ud574\uc11c \uc55e\uc11c 1\uc7a5\uacfc 5\uc7a5\uc5d0\uc11c \uc2dc\uc791\ud55c \ucee8\ud14c\uc774\ub108\ub97c \uc885\ub8cc\ud574\uc57c \ud569\ub2c8\ub2e4. "),(0,r.kt)("p",null,"\ub2e4\uc74c \uba85\ub839\uc5b4\ub97c \ud1b5\ud574 \uc885\ub8cc\uc2dc\ud0b5\ub2c8\ub2e4."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"$ docker rm --force postgres-server data-generator\n")),(0,r.kt)("h2",{id:"1-dockerfile-\uc791\uc131"},"1. Dockerfile \uc791\uc131"),(0,r.kt)("h3",{id:"11-dockerfile"},"1.1 Dockerfile"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"Dockerfile")," \uc740 \uc55e\uc120 \uc7a5\uc5d0\uc11c \uc791\uc131\ud55c \ub0b4\uc6a9\uc744 \uc0ac\uc6a9\ud558\uaca0\uc2b5\ub2c8\ub2e4."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-docker"},'FROM amd64/python:3.9-slim\n\nRUN apt-get update && apt-get install -y postgresql-client\n\nWORKDIR /usr/app\n\nRUN pip install -U pip &&\\\n    pip install scikit-learn pandas psycopg2-binary\n\nCOPY generate_data.py generate_data.py\n\nENTRYPOINT ["python", "data_generator.py", "--db-host"]\n# Change CMD to solve host finding error\nCMD ["localhost"]\n')),(0,r.kt)("h2",{id:"2-docker-compose"},"2. Docker-compose"),(0,r.kt)("p",null,"DB service \uc640 data generator service \ub97c \ub744\uc6b0\ub294 ",(0,r.kt)("inlineCode",{parentName:"p"},"docker-compose")," \ud30c\uc77c\uc744 \uc791\uc131\ud574\ubcf4\ub3c4\ub85d \ud558\uaca0\uc2b5\ub2c8\ub2e4."),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"docker-compose")," \uc740 \ub2e4\uc74c\uacfc \uac19\uc774 \ud615\ud0dc\ub85c \uad6c\uc131\ub418\uc5b4 \uc788\uc2b5\ub2c8\ub2e4."),(0,r.kt)("p",null,"\uad6c\uc131\uc694\uc18c\ub294 \ub2e4\uc74c\uacfc \uac19\uc2b5\ub2c8\ub2e4."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},'version: "3"\nservices:\n  \n')),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"version")," : ",(0,r.kt)("inlineCode",{parentName:"li"},"docker-compose")," \uc758 \ubc84\uc804\uc744 \uc758\ubbf8\ud569\ub2c8\ub2e4. \ucd5c\uc2e0 \ubc84\uc804\uc740 ",(0,r.kt)("a",{parentName:"li",href:"https://docs.docker.com/compose/compose-file/compose-versioning/"},"\uacf5\uc2dd \ud648\ud398\uc774\uc9c0"),"\uc5d0\uc11c \ud655\uc778\ud558\uc2e4 \uc218 \uc788\uc2b5\ub2c8\ub2e4."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"services")," : ",(0,r.kt)("inlineCode",{parentName:"li"},"docker-compose")," \uc5d0 \ubb36\uc77c \uc11c\ube44\uc2a4\ub4e4\uc744 \uc758\ubbf8\ud569\ub2c8\ub2e4.")),(0,r.kt)("h3",{id:"21-db-service-\uc791\uc131"},"2.1 DB service \uc791\uc131"),(0,r.kt)("p",null,"\uba3c\uc800, DB service \ub97c \uc544\ub798\uc640 \uac19\uc774 yaml \ud615\ud0dc\ub85c \uc791\uc131\ud569\ub2c8\ub2e4."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},'version: "3"\n\nservices:\n  postgres-server:\n    image: postgres:14.0\n    container_name: postgres-server\n    environment:\n      POSTGRES_USER: myuser\n      POSTGRES_PASSWORD: mypassword\n      POSTGRES_DB: mydatabase\n      TZ: Asia/Seoul\n    ports:\n      - 5432:5432\n    restart: unless-stopped\n')),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"db")," : DB service \uc758 \uc774\ub984\uc744 \uc9c0\uc815\ud569\ub2c8\ub2e4. \uc9c0\uc815\ud55c \uc774\ub984\uc740 \ub744\uc6b8 container \uc758 host \uc774\ub984\uc774 \ub429\ub2c8\ub2e4."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"version")," : docker-compose \ud30c\uc77c\uc5d0 \ub300\ud55c \ubc84\uc804\uc744 \uc9c0\uc815\ud569\ub2c8\ub2e4. \uc5ec\uae30\uc11c\ub294 ",(0,r.kt)("inlineCode",{parentName:"li"},"3")," \uc73c\ub85c \uc9c0\uc815\ud558\uaca0\uc2b5\ub2c8\ub2e4."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"image")," : container \uc5d0\uc11c \uc0ac\uc6a9\ud560 image \ub97c \uc9c0\uc815\ud569\ub2c8\ub2e4. \uc5ec\uae30\uc11c\ub294 ",(0,r.kt)("inlineCode",{parentName:"li"},"postgres:14.0")," \uc744 \uc0ac\uc6a9\ud558\ub3c4\ub85d \ud558\uaca0\uc2b5\ub2c8\ub2e4."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"environment")," : container \uc5d0\uc11c \uc0ac\uc6a9\ud560 \ud658\uacbd \ubcc0\uc218\ub97c \uc9c0\uc815\ud569\ub2c8\ub2e4. \uc5ec\uae30\uc11c\ub294 ",(0,r.kt)("inlineCode",{parentName:"li"},"POSTGRES_USER")," , ",(0,r.kt)("inlineCode",{parentName:"li"},"POSTGRES_PASSWORD")," , ",(0,r.kt)("inlineCode",{parentName:"li"},"POSTGRES_DB")," , ",(0,r.kt)("inlineCode",{parentName:"li"},"TZ")," \uc744 \uac01\uac01 ",(0,r.kt)("inlineCode",{parentName:"li"},"myuser")," , ",(0,r.kt)("inlineCode",{parentName:"li"},"mypassword")," , ",(0,r.kt)("inlineCode",{parentName:"li"},"mydatabase")," , ",(0,r.kt)("inlineCode",{parentName:"li"},"Asia/Seoul")," \uc73c\ub85c \uc9c0\uc815\ud558\uaca0\uc2b5\ub2c8\ub2e4.",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"\uc5ec\uae30\uc11c ",(0,r.kt)("inlineCode",{parentName:"li"},"TZ")," \uc740 Time Zone \uc744 \ub73b\ud569\ub2c8\ub2e4."))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"ports")," : host \uc640 container \uc758 port \ub97c \uc124\uc815\ud569\ub2c8\ub2e4. \ud615\uc2dd\uc740  ",(0,r.kt)("inlineCode",{parentName:"li"},"host:container")," \uc73c\ub85c \uc0ac\uc6a9\ub418\uba70, \uc5ec\uae30\uc11c\ub294 ",(0,r.kt)("inlineCode",{parentName:"li"},"5432:5432")," \ub85c \uc124\uc815\ud558\uaca0\uc2b5\ub2c8\ub2e4."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"restart")," : container \uc758 restart policy \ub97c \uc124\uc815\ud569\ub2c8\ub2e4. \uc790\uc138\ud55c \ub0b4\uc6a9\uc740 \uc544\ub798\uc758 \ub9c1\ud06c\ub97c \ucc38\uace0\ud574\uc8fc\uc138\uc694.",(0,r.kt)("br",{parentName:"li"}),"",(0,r.kt)("a",{parentName:"li",href:"https://docs.docker.com/config/containers/start-containers-automatically/"},"Start containers automatically"))),(0,r.kt)("h3",{id:"22-data-generator-service-\uc791\uc131"},"2.2 Data generator service \uc791\uc131"),(0,r.kt)("p",null,"\ub2e4\uc74c\uc73c\ub85c, data generator service \ub97c \uc544\ub798\uc640 \uac19\uc774 yaml \ud615\ud0dc\ub85c \uc791\uc131\ud569\ub2c8\ub2e4."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},'  data-generator:\n    build:\n      context: .\n      dockerfile: ./Dockerfile\n    container_name: data-generator\n    environment:\n      TZ: Asia/Seoul\n    command: ["postgres-server"]\n    depends_on: \n      - postgres-server\n')),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"build")," : ",(0,r.kt)("inlineCode",{parentName:"li"},"Dockerfile")," \uc744 build \ud558\uae30 \uc704\ud574 ",(0,r.kt)("inlineCode",{parentName:"li"},"Dockerfile")," \uc774 \uc788\ub294 \uacbd\ub85c\ub97c \uc124\uc815\ud569\ub2c8\ub2e4.",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"context")," : ",(0,r.kt)("inlineCode",{parentName:"li"},"Dockerfile")," \uc774 \uc788\ub294 \uc808\ub300\uacbd\ub85c \ub610\ub294 \uc0c1\ub300\uacbd\ub85c\ub97c \uc124\uc815\ud569\ub2c8\ub2e4."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"dockerfile")," : ",(0,r.kt)("inlineCode",{parentName:"li"},"context")," \uc5d0\uc11c \uc124\uc815\ud55c \uacbd\ub85c\uc5d0 \uc788\ub294 ",(0,r.kt)("inlineCode",{parentName:"li"},"Dockerfile")," \uc758 \ud30c\uc77c\uba85\uc744 \uc785\ub825\ud569\ub2c8\ub2e4."))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"command")," : Dockerfile\uc5d0 \uc791\uc131\ub418\uc5b4 \uc788\ub294 ",(0,r.kt)("inlineCode",{parentName:"li"},"CMD")," \ub97c \ub36e\uc5b4\uc501\ub2c8\ub2e4. \uc55e\uc120 \uc7a5\uc5d0\uc11c DB \uc758 host \ub294 \ucee8\ud14c\uc774\ub108\uc758 \uc774\ub984\uc73c\ub85c \uc8fc\uc5b4\uc57c \ud55c\ub2e4\ub294 \uac83\uc744 \uc124\uba85\ud588\uc2b5\ub2c8\ub2e4. \uc774\ub97c \uc704\ud574\uc11c \uc5ec\uae30\uc11c\ub294 ",(0,r.kt)("inlineCode",{parentName:"li"},'["postgres-server"]')," \ub85c \ub36e\uc5b4\uc501\ub2c8\ub2e4."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"depends_on")," : ",(0,r.kt)("inlineCode",{parentName:"li"},"docker-compose")," \ub85c \ub744\uc6cc\uc9c0\ub294 service \uac04\uc758 \uc885\uc18d\uc131 \uc21c\uc11c\ub300\ub85c service \ub97c \uc2dc\uc791\ud560 \ub54c \uc0ac\uc6a9\ud569\ub2c8\ub2e4. \uc5ec\uae30\uc11c\ub294 postgres server \uac00 \uba3c\uc800 \uc2e4\ud589\ub418\uace0 \ub09c \ub4a4\uc5d0 data generator server \ub97c \uc2e4\ud589 \ud574\uc57c\ud558\uae30 \ub54c\ubb38\uc5d0 postgres server \uc758 service \uc774\ub984\uc778 ",(0,r.kt)("inlineCode",{parentName:"li"},"db")," \ub97c \uc785\ub825\ud569\ub2c8\ub2e4.")),(0,r.kt)("h3",{id:"23-docker-compose-healthcheck-\uc124\uc815"},"2.3 Docker-compose healthcheck \uc124\uc815"),(0,r.kt)("p",null,"\uc55e\uc11c \uc791\uc131\ud55c docker-compose \ud30c\uc77c\uc744 \ud568\uaed8 \ub098\uc5f4\ud558\uba74 \uc544\ub798\uc640 \uac19\uc2b5\ub2c8\ub2e4."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},'version: "3"\n\nservices:\n  postgres-server:\n    image: postgres:14.0\n    container_name: postgres-server\n    environment:\n      POSTGRES_USER: myuser\n      POSTGRES_PASSWORD: mypassword\n      POSTGRES_DB: mydatabase\n      TZ: Asia/Seoul\n    ports:\n      - 5432:5432\n    restart: unless-stopped\n\n  data-generator:\n    build:\n      context: .\n      dockerfile: ./Dockerfile\n    container_name: data-generator\n    environment:\n      TZ: Asia/Seoul\n    command: ["postgres-server"]\n    depends_on: \n      - postgres-server\n')),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"docker compose up")," \uba85\ub839\uc5b4\ub97c \uc774\uc6a9\ud558\uc5ec service \ub4e4\uc744 \ub744\uc6cc\ubcf4\uaca0\uc2b5\ub2c8\ub2e4."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"$ docker compose up -d\n")),(0,r.kt)("p",null,"\ud558\uc9c0\ub9cc ",(0,r.kt)("inlineCode",{parentName:"p"},"docker ps")," \ub97c \uc785\ub825\ud574\ubcf4\uba74 postgres server \ub9cc \ub744\uc6cc\uc838\uc788\uc2b5\ub2c8\ub2e4."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'$ docker ps\nCONTAINER ID   IMAGE           COMMAND                  CREATED              STATUS              PORTS                    NAMES\n8a4a16837f28   postgres:14.0   "docker-entrypoint.s\u2026"   About a minute ago   Up About a minute   0.0.0.0:5432->5432/tcp   postgres-server\n')),(0,r.kt)("p",null,"Docker desktop \uc73c\ub85c \ubd10\ub3c4 \ub3d9\uc77c\ud55c \ud604\uc0c1\uc785\ub2c8\ub2e4."),(0,r.kt)("div",{style:{textAlign:"center"}},(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Container Networking Connetected",src:n(5464).Z,width:"1962",height:"426"}),(0,r.kt)("br",{parentName:"p"}),"\n","[\uadf8\ub9bc 1-5]"," Docker Desktop")),(0,r.kt)("p",null,"\uc65c \uc774\ub7f4\uae4c\uc694?"),(0,r.kt)("p",null,"\uc774\uc720\ub294 \uc55e\uc11c ",(0,r.kt)("inlineCode",{parentName:"p"},"depends_on")," \uc73c\ub85c service \uac04\uc758 \uc885\uc18d\uc131\uc740 \uc815\ud588\uc9c0\ub9cc, \uc2e4\uc81c\ub85c postgres server \uac00 \ub744\uc6cc\uc9c4 \ub4a4\uc5d0 \uace7\ubc14\ub85c data generator server \uac00 \ub744\uc6cc\uc9d1\ub2c8\ub2e4. ",(0,r.kt)("strong",{parentName:"p"},"postgres server \ub294 \uc544\uc9c1 \uc900\ube44\uac00 \ub418\uc5b4\uc788\uc9c0 \uc54a\uc740\ub370 data generator server \uac00 \ub744\uc6cc\uc838\uc11c DB connection \uc744 \ud558\ub824\ub2e4\ubcf4\ub2c8 data generator server \uac00 Exited \ub418\ub294 \ubb38\uc81c\uac00 \ubc1c\uc0dd\ud55c \uac83\uc785\ub2c8\ub2e4.")),(0,r.kt)("p",null,"\ub530\ub77c\uc11c \ud574\uacb0\ubc29\uc548\uc740 postgres server \uac00 \uc0ac\uc6a9 \uac00\ub2a5\ud55c \uc0c1\ud0dc\uac00 \ub418\uc5b4\uc788\ub294\uc9c0 \uccb4\ud06c\ub97c \ud55c \ub4a4\uc5d0 data generator server \ub97c \ub744\uc6cc\uc57c \ud569\ub2c8\ub2e4.",(0,r.kt)("br",{parentName:"p"}),"\n","\uc774\ub97c \ud574\uacb0\ud558\uae30 \uc704\ud55c \ubc29\ubc95\uc73c\ub85c ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/peter-evans/docker-compose-healthcheck"},"docker compose healthcheck")," \uc774 \uc788\uc2b5\ub2c8\ub2e4."),(0,r.kt)("p",null,"\uac04\ub2e8\ud558\uac8c \uc544\ub798\uc640 \uac19\uc774 yaml \ud30c\uc77c\uc5d0 ",(0,r.kt)("inlineCode",{parentName:"p"},"healthcheck")," \ubd80\ubd84\uacfc ",(0,r.kt)("inlineCode",{parentName:"p"},"condition")," \uc744 \ucd94\uac00\ud558\uba74 \ub429\ub2c8\ub2e4."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},'version: "3"\n\nservices:\n  postgres-server:\n    image: postgres:14.0\n    container_name: postgres-server\n    environment:\n      POSTGRES_USER: myuser\n      POSTGRES_PASSWORD: mypassword\n      POSTGRES_DB: mydatabase\n      TZ: Asia/Seoul\n    ports:\n      - 5432:5432\n    restart: unless-stopped\n    healthcheck:\n      test: ["CMD", "pg_isready", "-q", "-U", "myuser", "-d", "mydatabase"]\n      interval: 10s\n      timeout: 5s\n      retries: 5\n\n  data-generator:\n    build:\n      context: .\n      dockerfile: ./Dockerfile\n    container_name: data-generator\n    environment:\n      TZ: Asia/Seoul\n    command: ["postgres-server"]\n    depends_on:\n      postgres-server:\n        condition: service_healthy\n')),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"test")," : test \ud560 command \ub97c \uc124\uc815\ud569\ub2c8\ub2e4. \uc5ec\uae30\uc11c\ub294 ",(0,r.kt)("inlineCode",{parentName:"li"},"pg_isready")," \ub97c \uc774\uc6a9\ud558\uc5ec ",(0,r.kt)("inlineCode",{parentName:"li"},'["CMD", "pg_isready", "-q", "-U", "myuser", "-d", "mydatabase"]')," \ub97c \uc785\ub825\ud569\ub2c8\ub2e4."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"interval")," : health check \uac04\uaca9\uc744 \uc124\uc815\ud569\ub2c8\ub2e4. \uc5ec\uae30\uc11c\ub294 10\ucd08\ub85c \uc124\uc815\ud569\ub2c8\ub2e4."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"timeout")," : health check \uc758 timeout \uc744 \uc124\uc815\ud569\ub2c8\ub2e4. \uc5ec\uae30\uc11c\ub294 5\ucd08\ub85c \uc124\uc815\ud569\ub2c8\ub2e4."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"retries")," : timeout \uc758 \ud69f\uc218\ub97c \uc124\uc815\ud569\ub2c8\ub2e4. \uc5ec\uae30\uc11c\ub294 5\ubc88\uc73c\ub85c \uc124\uc815\ud569\ub2c8\ub2e4."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"condition")," : healthcheck \uae30\ub2a5\uc744 \uc0ac\uc6a9\ud558\uae30 \uc704\ud574 ",(0,r.kt)("inlineCode",{parentName:"li"},"depends_on")," \uc758 parameter \ub85c ",(0,r.kt)("inlineCode",{parentName:"li"},"condition: service_healthy")," \ub97c \ub123\uc5b4\uc90d\ub2c8\ub2e4. postgres server \uc758 healthcheck \ub97c data generator server \uc5d0\uc11c \uc801\uc6a9\uc2dc\ud0a4\uae30 \uc704\ud574 ",(0,r.kt)("inlineCode",{parentName:"li"},"db")," \ubc11\uc5d0 condition \uc744 \ucd94\uac00\ud558\uc600\uc2b5\ub2c8\ub2e4.")),(0,r.kt)("p",null,"\uc774\ub807\uac8c \uc124\uc815\ub41c \uac83\uc744 \uc815\ub9ac\ud574\ubcf4\uba74, 10\ucd08\ub9c8\ub2e4 test \ub97c \uc2e4\ud589\ud588\uc744 \ub54c 5\ucd08 \uc774\ub0b4\uc5d0 DB \uac00 ready \uc0c1\ud0dc\uac00 \ub418\uc5c8\ub294\uc9c0\ub97c \uccb4\ud06c\ud560 \uac83\uc774\uba70, \uc2e4\ud328 \uc2dc 5\ubc88 \uc7ac\uc2dc\ub3c4\ud55c\ub2e4\ub294 \ub73b\uc774 \ub429\ub2c8\ub2e4."),(0,r.kt)("p",null,"\uc774\uc678\uc5d0 \ub354 \uc790\uc138\ud55c \ub0b4\uc6a9\uc740 ",(0,r.kt)("a",{parentName:"p",href:"https://docs.docker.com/engine/reference/builder/#healthcheck"},"Dockerfile reference")," \uc744 \ucc38\uace0\ud574\uc8fc\uc2dc\uae30 \ubc14\ub78d\ub2c8\ub2e4."),(0,r.kt)("p",null,"\uc774\uc81c \ubaa8\ub450 \uc644\uc131\ub41c \uc804\uccb4 ",(0,r.kt)("inlineCode",{parentName:"p"},"docker-compose")," \ud30c\uc77c\uc744 ",(0,r.kt)("inlineCode",{parentName:"p"},"docker compose up")," \uba85\ub839\uc5b4\ub97c \uc774\uc6a9\ud558\uc5ec service \ub4e4\uc744 \ub744\uc6c1\ub2c8\ub2e4."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"$ docker compose up -d\n")),(0,r.kt)("h2",{id:"3-\ub370\uc774\ud130-\ud655\uc778"},"3. \ub370\uc774\ud130 \ud655\uc778"),(0,r.kt)("h3",{id:"31-local-\uc5d0\uc11c-\ud655\uc778"},"3.1 Local \uc5d0\uc11c \ud655\uc778"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"psql")," \uc744 \uc774\uc6a9\ud558\uc5ec DB \uc5d0 \uc811\uadfc\ud558\uace0, \uacc4\uc18d\ud574\uc11c data \uac00 \uc0bd\uc785\ub418\uace0 \uc788\ub294\uc9c0 \ud655\uc778\ud569\ub2c8\ub2e4."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'$ psql -h localhost -p 5432 -U myuser -d mydatabase\nPassword for user myuser: \npsql (14.3, server 14.0 (Debian 14.0-1.pgdg110+1))\nType "help" for help.\n\nmydatabase=# select * from iris_data;\n id | sepal_length | sepal_width | petal_length | petal_width | target \n----+--------------+-------------+--------------+-------------+--------\n  1 |            6 |         2.9 |          4.5 |         1.5 |      1\n  2 |          6.9 |         3.1 |          5.4 |         2.1 |      2\n  3 |          5.1 |         3.7 |          1.5 |         0.4 |      0\n  4 |          6.3 |         2.7 |          4.9 |         1.8 |      2\n  5 |          4.4 |         2.9 |          1.4 |         0.2 |      0\n  6 |          4.7 |         3.2 |          1.3 |         0.2 |      0\n')),(0,r.kt)("h3",{id:"32-data-generator-container-\uc5d0\uc11c-\ud655\uc778"},"3.2 Data generator container \uc5d0\uc11c \ud655\uc778"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"docker exec")," \ub97c \uc774\uc6a9\ud558\uc5ec data generator container \uc548\uc73c\ub85c \uc811\uc18d\ud558\uace0, ",(0,r.kt)("inlineCode",{parentName:"p"},"psql")," \uc744 \uc774\uc6a9\ud558\uc5ec DB \ub85c \uc811\uc18d\ud569\ub2c8\ub2e4. \uc774 \ub54c local \uc774 \uc544\ub2cc data generator container \uc5d0\uc11c \uc811\uc18d\ud574\uc57c \ud558\uae30 \ub54c\ubb38\uc5d0 host \ub97c ",(0,r.kt)("inlineCode",{parentName:"p"},"localhost")," \uc5d0\uc11c ",(0,r.kt)("inlineCode",{parentName:"p"},"db")," \ub85c \ubcc0\uacbd\ud569\ub2c8\ub2e4."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'$ docker exec -it data-generator /bin/bash\n\n$ psql -h db -p 5432 -U myuser -d mydatabase\nPassword for user myuser: \npsql (13.8 (Debian 13.8-0+deb11u1), server 14.0 (Debian 14.0-1.pgdg110+1))\nWARNING: psql major version 13, server major version 14.\n         Some psql features might not work.\nType "help" for help.\n\nmydatabase=# select * from iris_data;\n id | sepal_length | sepal_width | petal_length | petal_width | target \n----+--------------+-------------+--------------+-------------+--------\n  1 |            6 |         2.9 |          4.5 |         1.5 |      1\n  2 |          6.9 |         3.1 |          5.4 |         2.1 |      2\n  3 |          5.1 |         3.7 |          1.5 |         0.4 |      0\n  4 |          6.3 |         2.7 |          4.9 |         1.8 |      2\n  5 |          4.4 |         2.9 |          1.4 |         0.2 |      0\n  6 |          4.7 |         3.2 |          1.3 |         0.2 |      0\n')),(0,r.kt)("h3",{id:"33-docker-compose-\uc885\ub8cc"},"3.3 docker-compose \uc885\ub8cc"),(0,r.kt)("p",null,"Docker compose \ub97c \uc885\ub8cc\uc2dc\ud0a4\uae30 \uc704\ud574\uc11c\ub294 ",(0,r.kt)("inlineCode",{parentName:"p"},"docker-compose.yaml")," \uc774 \uc788\ub294 \ud3f4\ub354\uc5d0\uc11c ",(0,r.kt)("inlineCode",{parentName:"p"},"docker compose down")," \ub97c \ud1b5\ud574 \ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.",(0,r.kt)("br",{parentName:"p"}),"\n","\ub2e4\ub9cc \ub2e4\uc74c \ucc55\ud130\ub4e4\uc758 \uc6d0\ud560\ud55c \uc9c4\ud589\uc744 \uc704\ud574\uc11c \uc885\ub8cc \ud6c4 \ub2e4\uc2dc \uc2e4\ud589\uc2dc\ucf1c\ub194\uc57c \ud569\ub2c8\ub2e4."))}d.isMDXComponent=!0},5464:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/db-5-e81c25b4acc7c26b0bf4334a8c0804e1.png"}}]);